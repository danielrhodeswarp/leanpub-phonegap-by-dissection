<h2 id="splash_screen">Splash screen</h2>

<p>To kill the dragon, turn to page 84. To hide in the tunnel, keep reading.
LOL that was an interactive fiction reference, because this entire chapter is optional. Why?
Well it's about implementing a <em>splash screen</em> which is a contentious issue in the
world of Android apps. (It also involves fiddling with our app's Java sources which is a bit advanced for this tutorial.)</p>

<p>A splash screen is displayed after tapping
an app's launcher icon. They tend to fill the screen and disappear after a delay and / or
when the app is ready. Plenty of apps don't have one. Most big name games have one
as those apps can take a while to load. Small utility apps (which is what Japxlate is)
seem to mostly not have one.</p>

<p>Why is this contentious? Well, the thinking is that they form a barrier to using the app.
But they are something to look at when larger apps are loading which could be useful.</p>

<p>So make up your own mind (<a href="http://cyrilmottier.com/2012/05/03/splash-screens-are-evil-dont-use-them">http://cyrilmottier.com/2012/05/03/splash-screens-are-evil-dont-use-them</a> is useful) and skip this chapter if you feel Japxlate doesn't need a splash screen.
If you think it does need one - or just want to see how it generally works - then please read on.</p>

<hr>

<p>Hopefully only the first time while the Web SQL database is created, but our app may take a while to start, and we also want to have some branding.
So, we will have a splash screen.
PhoneGap exposes splash screen control in the "Splashscreen" API.
This needs to be installed as a plugin which can be done like this:</p>


<code class="terminal"><span>you@yours$ japxlate]$</span> phonegap local plugin add https://git-wip-us.apache.org/repos/asf/cordova-plugin-splashscreen.git</code>
<p class="new_3_3_0">(From PhoneGap v3.3.0 you can simply type <code>phonegap local plugin add org.apache.cordova.splashscreen</code>)</p>
<p>Under the hood, this command will do a few things for you:</p>

<ul>
<li>Add <code>&lt;feature name="SplashScreen"></code> to <code class="file">res/xml/config.xml</code></li>
<li>Put <code class="file">SplashScreen.java</code> in newly created <code class="file">/src/org/apache/cordova/splashscreen</code> folder
    (so this is an example of a plugin that will add to the native Java sources)</li>
<li>Put plugin in <code class="file">/assets/www/plugins/</code> <span class="new_3_3_0">(Because of the new Plugman, PhoneGap v3.3.0 instead puts the plugin in <code class="file">PROJECTROOT/plugins</code>)</span></li>
<li>Add references to the plugin in <code class="file">/assets/www/cordova_plugins.js</code></li>
</ul>

<p>So now we've got the JavaScript API exposing splash screen actions (show or hide). 
But this plugin has also added some native Java (the "SplashScreen" class).
Hold on to your hats folks because we're going to have to fiddle with the app's
Java source code! Don't worry though, it's pretty straightforward.
Open up <code class="file">Japxlate.java</code> (which is in <code class="file">/src/com/drappenheimer/japxlate</code>), it will
look like this:</p>

<code class="multiline">&vellip;
<span style='color:#7f0055; font-weight:bold; '>public</span> <span style='color:#7f0055; font-weight:bold; '>class</span> Japxlate <span style='color:#7f0055; font-weight:bold; '>extends</span> CordovaActivity 
{
    @Override
    <span style='color:#7f0055; font-weight:bold; '>public</span> <span style='color:#7f0055; font-weight:bold; '>void</span> onCreate(Bundle savedInstanceState)
    {
        <span style='color:#7f0055; font-weight:bold; '>super</span>.onCreate(savedInstanceState);
        <span style='color:#7f0055; font-weight:bold; '>super</span>.init();
        <span style='color:#3f7f59; '>// Set by &amp;lt;content src="index.html" /> in config.xml</span>
        <span style='color:#7f0055; font-weight:bold; '>super</span>.loadUrl(Config.getStartUrl());
        <span style='color:#3f7f59; '>//super.loadUrl("file:///android_asset/www/index.html")</span>
    }
}</code>

<p>This is the constructor code that gets the app up and running when the launcher icon is tapped.
All we do here is load (indirectly from <code class="file">config.xml</code>) <code class="file">index.html</code> into the current activity - which
is a WebView browser.
Change it to this:</p>

<code class="multiline"><span style='color:#7f0055; font-weight:bold; '>public</span> <span style='color:#7f0055; font-weight:bold; '>class</span> Japxlate <span style='color:#7f0055; font-weight:bold; '>extends</span> CordovaActivity 
{
    @Override
    <span style='color:#7f0055; font-weight:bold; '>public</span> <span style='color:#7f0055; font-weight:bold; '>void</span> onCreate(Bundle savedInstanceState)
    {
        <span style='color:#7f0055; font-weight:bold; '>super</span>.onCreate(savedInstanceState);
        <span style='color:#7f0055; font-weight:bold; '>super</span>.init();
        <span style='color:#3f7f59; '>// Set by &amp;lt;content src="index.html" /> in config.xml</span>
        <span style='color:#7f0055; font-weight:bold; '>super</span>.setIntegerProperty(<span style='color:#2a00ff; '>"splashscreen"</span>, R.drawable.splash);
        <span style='color:#7f0055; font-weight:bold; '>super</span>.loadUrl(Config.getStartUrl(), 5000);    <span style='color:#3f7f59; '>//5 seconds timeout for splash</span>
        <span style='color:#3f7f59; '>//super.loadUrl("file:///android_asset/www/index.html")</span>
    }
}</code>

<p>Before <code>super.loadUrl()</code>, we use <code>super.setIntegerProperty()</code> to set the "splashscreen"
property to <code>R.drawable.splash</code>. "R" is a piece of Java and XML magic which basically
picks up all the files and resources in the "res" folder and exposes them as useable
properties of the "R" object. <code>R.drawable.splash</code> refers to the appropriate
<code class="file">splash.png</code> placed in the <code class="file">/res/drawable</code> folder. <code class="file">splash.png</code> will be our image file
for the splash screen. We are about to make that, but first let's take a peek at the 
<code class="file">/res</code> folder structure:</p>

<div class="figure">
    <img src="img/figure/fig_530.png">
    <p>Figure 53. Contents of <code class="file">/res</code> folder (Eclipse IDE)</p>
</div>

<p>Opening up these folders we see:</p>

<div class="figure">
    <img src="img/figure/fig_540.png">
    <p>Figure 54. Exploded contents of <code class="file">/res</code> folder (NetBeans IDE)</p>
</div>

<p>The <code class="file">icon.png</code> files are the PhoneGap default launcher icons (we'll be changing these a bit later).
As the name suggests, the <code class="file">drawable</code> folder is where we place any kind of image resource
that our app needs.
What's going on here is that, as well as the generic drawable folder, we have four other drawable
folders tailored to different screen pixel densities. A high-end Android device
will have well over 300 pixels-per-inch. In fact a full-HD phone with a compactish (5" or less) display
will probably have over 400!
Imagine our launcher icon is fixed at 32 pixels square. This is going to be tiny on a display
with 400 pixels-per-inch!
The more dense the display pixels are, the larger our launcher icon needs to be to stay the
same physical size and to show the same amount of detail. This is true for splash screen images,
launcher icons, and any drawable.
Back to these folders, we have:</p>

<ul>
<li>drawable-ldpi - "low dots-per-inch" (default launcher icon = 36x36)</li>
<li>drawble-mdpi - "medium dots-per-inch" (default launcher icon = 48x48)</li>
<li>drawable-hdpi - "high dots-per-inch" (default launcher icon = 72x72)</li>
<li>drawable-xhdpi - "eXtra high dots-per-inch" (default launcher icon = 96x96)</li>
</ul>

<p>(Gory details at <a href="http://developer.android.com/guide/practices/screens_support.html]">http://developer.android.com/guide/practices/screens_support.html</a>)</p>

<p>So for our splash screen we need to put a <code class="file">splash.png</code> of correct size
in each of these folders. But just to make sure our code works first we can simply
put one <code class="file">splash.png</code> in the "drawable" folder. Our device will suss that there is no <em>specific</em>
splash image for its native DPI and simply display the default one in the "drawable" folder. Which obviously
might look hideous if the image is too small for the display (or vice versa).
Let's do that first just to get the code working and then we can put in the proper images.</p>

<p>OK, so make (or get from the Japxlate sources) a muckabout png in portrait shape of size
320x470. It's going to be the Japxlate "J" in our signature red.</p>


<p>Put the png file in the drawable folder and run the app on your device.
You should get the image splashed onto the display for 5 seconds
before the app starts. It might look very stretched out and jaggedy. Note that the splash screen will not appear when running the app in desktop Chrome
(which is a good thing).</p>

<div class="sidenote">
<p>If you've added the status bar to the app as discussed at the end of the <a href="#first_things_first_the_layout">First things first: The layout</a> chapter,
you'll still have the status bar when the splash screen is being displayed. 
</p>
</div>

<p>Hmmm, but what if 5 seconds is too long? The app might load much quicker than that and we
want the splash screen to disappear as soon as the app loads.
Well I remember seeing something in <code class="file">config.xml</code>:</p>

<code class="multiline">&lt;preference name="auto-hide-splash-screen" value="true" /></code>

<p>So maybe the splash screen is auto hiding as soon as the app is ready, and, by coincidence, our app is taking 5 seconds to load?
Well, let's test that by changing the timeout in <code class="file">Japxlate.java</code> to 20 seconds:</p>

<code class="multiline">&vellip;
<span style='color:#7f0055; font-weight:bold; '>public</span> <span style='color:#7f0055; font-weight:bold; '>class</span> Japxlate <span style='color:#7f0055; font-weight:bold; '>extends</span> CordovaActivity 
{
    @Override
    <span style='color:#7f0055; font-weight:bold; '>public</span> <span style='color:#7f0055; font-weight:bold; '>void</span> onCreate(Bundle savedInstanceState)
    {
        <span style='color:#7f0055; font-weight:bold; '>super</span>.onCreate(savedInstanceState);
        <span style='color:#7f0055; font-weight:bold; '>super</span>.init();
        <span style='color:#3f7f59; '>// Set by &amp;lt;content src="index.html" /> in config.xml</span>
        <span style='color:#7f0055; font-weight:bold; '>super</span>.setIntegerProperty(<span style='color:#2a00ff; '>"splashscreen"</span>, R.drawable.splash);
        <span style='color:#7f0055; font-weight:bold; '>super</span>.loadUrl(Config.getStartUrl(), 20000);
        <span style='color:#3f7f59; '>//super.loadUrl("file:///android_asset/www/index.html")</span>
    }
}</code>

<p>Run this and we see that the splash screen does indeed hang around for 20 seconds. The app
is not quite that slow and so we need a way to hide the splash screen
when the app is ready.
We learn from <a href="http://docs.phonegap.com/en/3.1.0/cordova_splashscreen_splashscreen.md.html#Splashscreen">http://docs.phonegap.com/en/3.1.0/cordova_splashscreen_splashscreen.md.html#Splashscreen</a>
that "To dismiss the splash screen once the app receives the deviceready event, call the navigator.splashscreen.hide() method."

Let's try that. Edit <code>thereceivedEvent()</code> method in <code class="file">index.js</code> to look like this:</p>

<code class="multiline"><span style='color:#3f7f59; '>// Update DOM on a Received Event</span>
receivedEvent: <span style='color:#7f0055; font-weight:bold; '>function</span>(id) {
    console.<span style='color:#7f0055; font-weight:bold; '>log</span>(<span style='color:#2a00ff; '>'Received Event: '</span> + id);

    <span style='color:#7f0055; font-weight:bold; '>if</span> (window.cordova) {   <span style='color:#3f7f59; '>//actual app</span>
        navigator.splashscreen.hide();
    }
&vellip;</code>

<p>As the whole of <code>receivedEvent()</code> is called from both our actual device and debugging
in desktop Chrome*, we need to check for <code>window.cordova</code> - ie. we're on the device - before
calling <code>navigator.splashscreen.hide();</code>.</p>

<p>*Which does not need to be the case but is just how our simple app has evolved.</p>

<p>Run this on your device and you will see that the splash screen disappears when the app is ready,
much sooner than 20 seconds! great!</p>

<p>OK, we now need to create the actual splash screen images in the correct sizes.
The correct sizes for each image should be:</p>

<ul>
<li>xlarge (xhdpi): at least 960 × 720</li>
<li>large (hdpi): at least 640 × 480</li>
<li>medium (mdpi): at least 470 × 320</li>
<li>small (ldpi): at least 426 × 320</li>
</ul>

<p>So go ahead and create (or get from Japxlate repo) your final "J" images in these sizes and put them in the
correct drawables folders.</p>

<div class="sidenote">
If the image with the correct density for the device is missing, the app seems to find and use the <em>closest</em> matching one.
</div>

<p>Just one problem remains. Rotate your device into landscape and launch the app. Yuck!
Did you see the splash image? It was really stretched out and fat.</p>

<div class="figure">
    <img src="img/figure/fig_550.png">
    <p>Figure 55. Splash screen when in landscape orientation</p>
</div>

<p>Well here's the correct way to solve this. <em>Really</em> for splash images - and other drawables - you should use
a "9 patch" graphic. This is a tricky little format where PNG images have a one-pixel border
that isn't displayed, but contains control pixels telling Android which bits of the image
to stretch, shrink or leave unaltered when the device is rotated or if the target device's
aspect ratio is not the same as the drawable file in the app.</p>

<p>As you can see already, normal PNGs placed in the drawable folder essentially work, so this tutorial
won't cover 9 patch images any more other than to say that the gory details are here:</p>

<p><a href="https://developer.android.com/guide/topics/graphics/2d-graphics.html#nine-patch">https://developer.android.com/guide/topics/graphics/2d-graphics.html#nine-patch</a><br>
"A NinePatchDrawable graphic is a stretchable bitmap image, which Android will automatically resize to accommodate the contents of the View in which you have placed it as the background. An example use of a NinePatch is the backgrounds used by standard Android buttons — buttons must stretch to accommodate strings of various lengths. A NinePatch drawable is a standard PNG image that includes an extra 1-pixel-wide border. It must be saved with the extension .9.png, and saved into the res/drawable/ directory of your project."</p>

<p>and that the Android SDK has a little tool called draw9patch (in ANDROID_SDK_HOME/sdk/tools) to make
these images which looks like this:</p>

<div class="figure">
    <img src="img/figure/fig_560.png">
    <p>Figure 56. Android SDK's draw9patch utility</p>
</div>

<p class="new_3_3_0">
The PhoneGap / Cordova documentation for v3.3.0 now has a useful summary section on <a href="http://docs.phonegap.com/en/3.3.0/config_ref_images.md.html#Icons%20and%20Splash%20Screens">Icons and Splash Screens</a>.
</p>

